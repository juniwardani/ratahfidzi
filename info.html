<html class="scroll-smooth" lang="id">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Aplikasi RA TAHFIDZI
  </title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
   body {
      font-family: 'Inter', sans-serif;
      background-color: #f0fdf4; /* Light greenish background */
    }
    /* 3D effect and shadow for cards */
    .card-3d {
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transform-style: preserve-3d;
      perspective: 1000px;
      cursor: pointer;
      background: linear-gradient(145deg, #ffffff, #f0fdf4);
      border: 1px solid rgba(16, 185, 129, 0.1);
      position: relative;
      overflow: hidden;
    }
    .card-3d:hover {
      transform: translateY(-8px) rotateX(5deg);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    .card-3d::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #10b981, #059669);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .card-3d:hover::before {
      opacity: 1;
    }
    .card-3d .card-content {
      padding: 0.75rem;
      text-align: center;
      transform: translateZ(20px);
    }
    .card-3d .card-title {
      color: #065f46;
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .card-3d .card-number {
      color: #047857;
      font-size: 1.5rem;
      font-weight: 700;
      margin: 0.25rem 0;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }
    .card-3d .card-icon {
      font-size: 1.25rem;
      color: #10b981;
      margin-bottom: 0.5rem;
      opacity: 0.8;
    }
    @media (min-width: 640px) {
      .card-3d .card-content {
        padding: 1.5rem;
      }
      .card-3d .card-title {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
      }
      .card-3d .card-number {
        font-size: 2.5rem;
        margin: 0.5rem 0;
      }
      .card-3d .card-icon {
        font-size: 2rem;
        margin-bottom: 1rem;
      }
    }
    /* Navigation styles */
    .nav-card {
      background-color: #059669 !important;
      color: white !important;
      font-weight: 600;
      padding: 1rem 1.5rem;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      text-decoration: none;
      display: block;
      width: 100%;
      text-align: center;
    }
    .nav-card:hover {
      background-color: #047857 !important;
      transform: translateY(-2px);
      box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
    }
    .nav-card:active {
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    /* Table styles */
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid #d1d5db; /* Tailwind gray-300 */
      padding: 0.5rem 0.75rem;
      text-align: left;
    }
    th {
      background-color: #d1fae5; /* Tailwind green-100 */
      color: #065f46; /* Tailwind green-800 */
      font-weight: 600;
    }
    tbody tr:nth-child(even) {
      background-color: #f0fdf4; /* Tailwind green-50 */
    }
  </style>
 </head>
 <body class="flex flex-col min-h-screen">
  <!-- Header -->
  <header class="bg-green-700 text-white shadow-md">
   <div class="container mx-auto px-4 py-4 flex items-center justify-between">
    <div class="flex items-center space-x-3">
     <img src="img/logo.png" alt="Logo" width="48"/>
     <h1 class="text-xl font-semibold">
      RA TAHFIDZI
     </h1>
    </div>

  </header>
  <!-- Main content -->
  <main class="flex-grow container mx-auto px-4 py-8">
   <h1 class="max-w-4xl mx-auto text-green-800 font-semibold text-2xl mb-4 text-center">
    Menu Informasi
   </h1>
   <section aria-label="Statistik utama" class="max-w-4xl mx-auto grid grid-cols-3 gap-4 mb-8">
    <div class="card-3d rounded-xl" id="card-guru" tabindex="0" role="button" aria-expanded="false" aria-controls="detail-guru">
     <div class="card-content">
      <i class="fas fa-chalkboard-teacher card-icon"></i>
      <h2 class="card-title">Jumlah Guru</h2>
      <p class="card-number"></p>
     </div>
    </div>
    <div class="card-3d rounded-xl" id="card-siswa" tabindex="0" role="button" aria-expanded="false" aria-controls="detail-siswa">
     <div class="card-content">
      <i class="fas fa-user-graduate card-icon"></i>
      <h2 class="card-title">Jumlah Siswa</h2>
      <p class="card-number"></p>
     </div>
    </div>
    <div class="card-3d rounded-xl" id="card-kelas" tabindex="0" role="button" aria-expanded="false" aria-controls="detail-kelas">
     <div class="card-content">
      <i class="fas fa-school card-icon"></i>
      <h2 class="card-title">Jumlah Kelas</h2>
      <p class="card-number"></p>
     </div>
    </div>
   </section>

   <!-- Detail Tables -->
   <section class="max-w-4xl mx-auto mb-8 space-y-6">
    <!-- Detail Guru -->
    <div class="hidden bg-white rounded-lg shadow-md p-4" id="detail-guru" role="region" aria-labelledby="card-guru" tabindex="0">
     <h3 class="text-green-800 font-semibold mb-3 text-center">Daftar Guru</h3>
     <table>
      <thead>
       <tr>
        <th scope="col">No.</th>
        <th scope="col">Nama Guru</th>
        <th scope="col">Jabatan</th>
       </tr>
      </thead>
      <tbody>
      </tbody>
     </table>
    </div>
    <!-- Detail Siswa -->
    <div class="hidden bg-white rounded-lg shadow-md p-4" id="detail-siswa" role="region" aria-labelledby="card-siswa" tabindex="0">
     <h3 class="text-green-800 font-semibold mb-3 text-center">Detail Jumlah Siswa per Kelas</h3>
     <table>
      <thead>
       <tr>
        <th scope="col">No. Kelas</th>
        <th scope="col">L</th>
        <th scope="col">P</th>
        <th scope="col">Total</th>
       </tr>
      </thead>
      <tbody>
      </tbody>
     </table>
    </div>
    <!-- Detail Kelas -->
    <div class="hidden bg-white rounded-lg shadow-md p-4" id="detail-kelas" role="region" aria-labelledby="card-kelas" tabindex="0">
     <h3 class="text-green-800 font-semibold mb-3 text-center">Detail Jumlah Siswa per Kelas</h3>
     <table>
      <thead>
       <tr>
        <th scope="col">No. Kelas</th>
        <th scope="col">Wali Kelas</th>
        <th scope="col">Jumlah Siswa</th>
       </tr>
      </thead>
      <tbody>
      </tbody>
     </table>
    </div>
   </section>

   <section aria-label="Navigasi utama aplikasi" class="max-w-xl mx-auto flex flex-col gap-4 mb-8">
    <a class="nav-card block w-full text-center" href="kaldik.html" role="button">
      Kalender Pendidikan
     </a>
     <a class="nav-card block w-full text-center" href="rppm/input.html" role="button">
      Input dan Cetak RPPM
     </a>
         <a class="nav-card block w-full text-center" href="rpph/rpph.html" role="button">
      Input dan Cetak RPPH
     </a>
      <a class="nav-card block w-full text-center" href="rppm/tahfidz.html" role="button">
      Penilaian Tahfidz
         </a>
     <a class="nav-card block w-full text-center" href="analisis.html" role="button">
      Analisi Kehadiran Siswa
     </a>
    <a class="nav-card block w-full text-center" href="rekom.html" role="button">
     Data Guru, Siswa, dan Alumni
            <a class="nav-card block w-full text-center" href="sarpras.html" role="button">
     Sarana dan Prasarana
            </a>

   </section>
   <div aria-live="polite" class="max-w-xl mx-auto bg-green-100 border border-green-400 rounded-lg p-6 shadow-md flex items-center space-x-4" role="alert">
    <div class="flex-shrink-0 text-green-700">
     <i class="fas fa-info-circle fa-2x"></i>
    </div>
    <p class="text-green-800 font-semibold text-center sm:text-left">
     Aplikasi ini berfungsi sebagai arsip digital saat kunjungan pengawas,
        penyusunan EDM, dan persiapan akreditasi.
    </p>
   </div>
  </main>
  <!-- Footer -->
  <footer class="bg-green-700 text-green-100">
   <div class="container mx-auto px-4 py-6 flex flex-col md:flex-row justify-center items-center space-y-4 md:space-y-0">
    <p class="text-sm">
     Â© 2024 RA TAHFIDZI. Semua hak cipta dilindungi.
    </p>
   </div>
  </footer>
  <script>
  if (location.protocol !== 'file:') {
    // Inisialisasi Supabase
    const supabaseUrl = 'https://hjvppgbcltgiibdxqtka.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhqdnBwZ2JjbHRnaWliZHhxdGthIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQyNzUzNDgsImV4cCI6MjA0OTg1MTM0OH0.3X7KMHg3qMdsgYsulWxC-hGvpjkGt-9V_YTbd7PSeOw';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    // Fungsi untuk cek koneksi Supabase
    async function cekKoneksiSupabase() {
      try {
        const { error } = await supabase.from('ra_guru').select('id').limit(1);
        if (error) throw error;
        return true;
      } catch (e) {
        return false;
      }
    }

    // Fungsi untuk mengambil dan menampilkan jumlah data
    async function loadCounts() {
      try {
        // Cek koneksi Supabase dulu
        const konek = await cekKoneksiSupabase();
        if (!konek) {
          alert('Tidak dapat terhubung ke server Supabase. Cek koneksi internet atau pengaturan CORS Supabase Anda.');
          return;
        }

        // Ambil jumlah guru
        const { count: guruCount, error: guruError } = await supabase
          .from('ra_guru')
          .select('*', { count: 'exact', head: true });
        if (guruError) throw guruError;
        document.querySelector('#card-guru p').textContent = guruCount;

        // Ambil jumlah siswa
        const { count: siswaCount, error: siswaError } = await supabase
          .from('ra_siswa')
          .select('*', { count: 'exact', head: true });
        if (siswaError) throw siswaError;
        document.querySelector('#card-siswa p').textContent = siswaCount;

        // Ambil jumlah kelas
        const { count: kelasCount, error: kelasError } = await supabase
          .from('ra_kelas')
          .select('*', { count: 'exact', head: true });
        if (kelasError) throw kelasError;
        document.querySelector('#card-kelas p').textContent = kelasCount;

        // Update detail guru
        const { data: guruData, error: guruDetailError } = await supabase
          .from('ra_guru')
          .select('id, nama, jabatan')
          .order('jabatan', { ascending: true });

        if (guruDetailError) throw guruDetailError;
        
        // Urutkan data guru sesuai prioritas jabatan
        const sortedGuruData = guruData.sort((a, b) => {
          const jabatanOrder = {
            'Kepala RA': 1,
            'Wali Kelas A1': 2,
            'Wali Kelas A2': 3,
            'Wali Kelas B1': 4,
            'Wali Kelas B2': 5
          };
          
          const orderA = jabatanOrder[a.jabatan] || 9;
          const orderB = jabatanOrder[b.jabatan] || 9;
          
          if (orderA === orderB) {
            return a.nama.localeCompare(b.nama);
          }
          return orderA - orderB;
        });

        const guruTableBody = document.querySelector('#detail-guru tbody');
        guruTableBody.innerHTML = sortedGuruData.map((guru, index) => `
          <tr><td>${index + 1}</td><td>${guru.nama}</td><td>${guru.jabatan || 'ra_guru'}</td></tr>
        `).join('');

        // Update detail siswa per kelas
        const { data: kelasData, error: kelasDetailError } = await supabase
          .from('ra_kelas')
          .select('id, nama_kelas')
          .order('nama_kelas');

        if (kelasDetailError) throw kelasDetailError;

        const siswaTableBody = document.querySelector('#detail-siswa tbody');
        const kelasTableBody = document.querySelector('#detail-kelas tbody');
        
        // Reset tabel
        siswaTableBody.innerHTML = '';
        kelasTableBody.innerHTML = '';

        for (const kelas of kelasData) {
          // Hitung jumlah siswa per jenis kelamin
          const { data: siswaData, error: siswaDetailError } = await supabase
            .from('ra_siswa')
            .select('jenis_kelamin')
            .eq('kelas_id', kelas.id);

          if (siswaDetailError) throw siswaDetailError;

          // Hitung jumlah berdasarkan jenis kelamin
          const lakiLaki = siswaData.filter(s => s.jenis_kelamin === 'Laki-laki').length;
          const perempuan = siswaData.filter(s => s.jenis_kelamin === 'Perempuan').length;
          const total = siswaData.length;

          // Update tabel detail siswa
          siswaTableBody.innerHTML += `
            <tr>
              <td>${kelas.nama_kelas}</td>
              <td>${lakiLaki}</td>
              <td>${perempuan}</td>
              <td>${total}</td>
            </tr>
          `;

          // Ambil data wali kelas dari guru_kelas
          const { data: guruKelasData, error: guruKelasError } = await supabase
            .from('ra_guru_kelas')
            .select(`
              id,
              guru_id,
              kelas_id,
              guru:guru_id (
                nama
              )
            `)
            .eq('kelas_id', kelas.id);

          if (guruKelasError) throw guruKelasError;

          let waliKelas = '-';
          if (guruKelasData && guruKelasData.length > 0) {
            waliKelas = guruKelasData[0].guru.nama;
          }

          // Update tabel detail kelas
          kelasTableBody.innerHTML += `
            <tr>
              <td>${kelas.nama_kelas}</td>
              <td>${waliKelas}</td>
              <td>${total}</td>
            </tr>
          `;
        }

      } catch (error) {
        console.error('Error:', error);
        alert('Terjadi kesalahan saat mengambil data: ' + (error.message || error));
      }
    }

    document.addEventListener('DOMContentLoaded', loadCounts);

    const cards = [
      { cardId: 'card-guru', detailId: 'detail-guru' },
      { cardId: 'card-siswa', detailId: 'detail-siswa' },
      { cardId: 'card-kelas', detailId: 'detail-kelas' }
    ];

    cards.forEach(({ cardId, detailId }) => {
      const card = document.getElementById(cardId);
      const detail = document.getElementById(detailId);

      function toggleDetail() {
        const isVisible = !detail.classList.contains('hidden');
        // Hide all details
        cards.forEach(({ detailId: dId, cardId: cId }) => {
          document.getElementById(dId).classList.add('hidden');
          document.getElementById(cId).setAttribute('aria-expanded', 'false');
        });
        if (!isVisible) {
          detail.classList.remove('hidden');
          card.setAttribute('aria-expanded', 'true');
          detail.focus();
        } else {
          card.setAttribute('aria-expanded', 'false');
        }
      }

      card.addEventListener('click', toggleDetail);
      card.addEventListener('keydown', e => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          toggleDetail();
        }
      });
    });
  }
  </script>
 </body>
</html>
